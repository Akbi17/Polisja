<?php
declare(strict_types=1);

namespace App\Block;

use Doctrine\ORM\EntityManagerInterface;
use Symfony\Component\Form\FormInterface;
use Symfony\Component\HttpFoundation\RequestStack;

class ConfigManager
{
    private $entityManager;
    private $requestStack;

    public function __construct(EntityManagerInterface $entityManager, RequestStack $requestStack)
    {
        $this->entityManager = $entityManager;
        $this->requestStack = $requestStack;
    }

    public function handleConfigForm(FormInterface $form, FormInterface $configDataForm): bool
    {
        $request = $this->requestStack->getCurrentRequest();

        if (!$request->isMethod('POST')) {
            return false;
        }

        $form->handleRequest($request);
        $configDataForm->handleRequest($request);

        if ($form->isSubmitted() && $form->isValid()) {
            // Handle the form submission and database operations here
            // ...
            return true;
        }

        if ($configDataForm->isSubmitted() && $configDataForm->isValid()) {
            $Data = $formConfigData->getData();
                
            $entityManager = $this->doctrine->getManager();
            
            $existingWebPage = $entityManager->getRepository(Config::class)->findOneBy(['name' => $Data->getName()]);
            
            if ($existingWebPage) {
                $existingWebPage->setValue($Data->getValue());
            } else {
                $existingWebPage = $Data;
            }

            $entityManager->persist($existingWebPage);
            $entityManager->flush();

            $this->addFlash('success', 'Zmiany zostaÅ‚y zapisane.');
            return true;
        }

        return false;
    }
}
